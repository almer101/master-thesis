\documentclass[times, utf8, diplomski]{fer}
\usepackage{booktabs}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{pgfplots}

\pgfplotsset{width=13cm, compat=1.5}
\pgfplotsset{soldot/.style={color=black,only marks,mark=*}} \pgfplotsset{holdot/.style={color=black,fill=white,only marks,mark=*}}

\begin{document}

\renewcommand*\contentsname{Table of contents}
\newcommand\indeq{\mathrel{\overset{\makebox[0pt]{\mbox{\normalfont\tiny\sffamily ind.}}}{=}}}
% TODO: substitute theorems in the text with theorem tag
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{definition}{Definition}

\renewcommand{\labelitemi}{$\bullet$}

\thesisnumber{2748}

\title{Option Pricing and Hedging under Jump-diffusion model}

\author{Ivan Almer}
\voditelj{Tomislav Burić}

\maketitle

% Ispis stranice s napomenom o umetanju izvornika rada. Uklonite naredbu \izvornik ako želite izbaciti tu stranicu.
% \izvornik

% Dodavanje zahvale ili prazne stranice. Ako ne želite dodati zahvalu, naredbu ostavite radi prazne stranice.
\zahvala{}

\tableofcontents

\chapter{Introduction}
% motivation
Stochastic or random process is a mathematical object which is usually defined as a collection of random variables. It can be seen as a random variable evolving over time. The weather, for example, is a stochastic process. A lot of such examples can be found in everyday life and stochastic processes can be used to model any kind of process that, in itself, has some kind of uncertainty involved. 

Compared to a deterministic function, for which, at any time we know its value, in case of a stochastic process one cannot for sure know its value, but can maybe have an estimation or a probability of having a certain value. Although it is not ideal, it is for sure better than not knowing anything about it whatsoever. Under the assumption that processes in real world are random, but are to some degree \textit{defined}, gives us hope that, without knowing their exact future behaviour or position, we can have a good feeling of how they could move.

Stochastic processes have a very wide application in the field of finance. The main reason for that is that they can be used to model an asset price as a process where uncertainty is present. Behaviour of such processes can be observed to potentially draw some conclusions from them. 

The goal of this thesis is to utilize stochastic processes and apply them to tackle some of the problems from mathematical finance. Firstly, I will start with defining necessary mathematical and financial concepts which will be used throughout this thesis. After this foundation is set, starting with Brownian motion, step-by-step we will arrive at the jump-diffusion process which will be used as a process of the price of an asset. We will then introduce the idea of a financial derivative, in our case an option, and we will tackle the problem of determining a fair price of the option. Lastly, we will introduce the idea of risk, how to quantify it and how to hedge the risk of our position in the asset or the option. It is my hope that, this thesis will not only provide you with a good overview of pricing and hedging of financial instruments, but also give you the understanding of such the underlying processes are useful to model the scenarios that occur every day in the market.

\chapter{Financial concepts}
% \section{General terms}
% market, trade, law of supply and demand
Let us start by defining what a market is. \textbf{Market} is a place where parties can meet to engage in an economic transaction. Usually, while only two parties are needed to make a trade, at minimum one more party is needed to introduce competition and bring balance to the market. A market in a state of \textbf{perfect competition} is characterized by a high number of active buyers and sellers. Markets vary for a number of reasons, including the types of products sold, size, location etc. One market which is of particular interest to us is the \textbf{financial market} where securities, currencies, bonds and other types of securities are traded. They form capital and provide liquidity for businesses. Stock exchanges like New York Stock Exchange (NYSE) or Nasdaq are one type of financial markets. Other types of finincial markets include, for example bond markets and foreign exchange (FX) markets. 

As already mentioned, markets in perfect competition have a high number of participants (buyers and sellers) and market determines the prices of goods and other servides traded there. Prices are determined by \textbf{supply and demand}, where supply is created by the sellers and demand by the buyers. The law of supply and demand is a theory that explains the interaction between the sellers of a resource and the buyers for that resource. In general, if the price for a good decreases, more people are willing to buy it and less people are willing to sell. That is because the oportunity cost for the buyers increases, as they can obtain the good at a lower price than earlier, whereas the oportunity cost for the sellers increases, as they earn less by selling the same amount of goods as before. Although it is one of the most basic economic laws, it is a part of almost all economic principles. The willingness of people to buy or sell a good determines the market equilibrium price at which the quantity of goods people are willing to sell equals the quantity of goods people are willing to buy. 

\section{Financial instruments}
% bonds, stocks, derivatives -> this will be used later
% https://www.investopedia.com/terms/f/financialinstrument.asp
In this section we will cover a few basic financial instruments. As discussed earlier, different types of markets offer different types of goods. A \textbf{bond market} (also called fixed-income markets) is a collective name attributed to all issues and trades of debt securities. Stock exchange is another type of market where, among many other things, \textbf{stocks} and \textbf{derivatives} can be traded. 

\hfill \break
A \textbf{bond} is a fixed-income financial instrument typically issued by governments or corporations in order to raise money needed to fund a certain project, for example. When a corporation (or a government) needs to borrow money, it issues bonds that include the terms of the loan, the time at which the loaned funds (bond principal) must be paid back (maturity date) and the interest payments that will be paid. They can essentially be thought of as a contract issued by the borrower promising to pay back the loan plus some interest on it at some time in the future. The interest is a premium for the person loaning the money, because by buying a bond (loaning money) the buyer takes on a risk that the issuer will not be able to pay back at maturity (risk of default). Governments are typically less likely to fail than corporations, therefore the interest paid on government bonds is genereally lower than the interest paid on corporate bonds. There are also bonds that pay additional coupons between the issuance and maturity, but we won't go into them since they will not be of particular interest to us in this thesis.

\hfill \break
A \textbf{stock} (also called \textit{equity}) is a type of a security issued by the corporations and represents the ownership of a fraction of a company. The units of stock is called \textit{shares}. They are issued for a company to raise funds to operate their business. It is important to point out that corporations are treated as legal persons, so a shareholder does not \textit{own} a corporation, but own shares issued by the corporations and have a claim on its assets and earnings.

\hfill \break
Having explained the characteristics of bonds and stocks we arrive at securities that are not completely basic. \textbf{Derivatives} are a type of security which \textit{derives} its value from another asset (e.g. stock). There are many types of derivatives, but we will focus on the ones used in this thesis and those are options. \textbf{Option} is a contract that gives the buyer a right, but not an obligation, to buy or sell (depending on the type of the contract they hold) the underlying asset at a certain time in future. 

\hfill \break
\textbf{European options} (also called \textit{vanilla} options) are the most basic form of an option. We differentiate two different types of european options: \textit{call} and \textit{put} option. A call option gives a buyer a right to buy the underlying security at some predetermined price (strike price) at a certain time in future (maturity). In case the price of the underlying asset is higher than the strike price at the time of maturity, the buyer can buy the underlying asset at the strike price and immediately sell the asset at its market price which is now higher than the strike price, thus making a profit. However, if the price of the underlying asset is less than the strike price at maturity, it does not make sense for the buyer to excercise the option and buy the asset at strike price, because she/he can simply buy the asset at the market price. In this case the options will expire without excercising and the only loss made by the buyer is the amount paid for the option in the first place. To illustrate this very important concept of European options let us look at the following example:

\hfill \break
\noindent Suppose at time $t=0$ the price of an asset is $S_0 = 100$ and that we can buy a \textit{put} option with maturity $T$ and strike price $K=90$. The price of such option contract at time $t=0$ is $P = 5$. Let us assume that at maturity the price of the asset is $S_T = 93$. This means that the buyer will simply let the contract expire because the asset can be sold at a market price which is higher than the strike price of the \textit{put} option. If, however, the price of an asset dips below $S_0$ to value of $S_T = 80$, the buyer can buy the asset in the market for the price of $80$ and immediately sell it in the market for $K=90$ by excercising the option. Thus, making a profit of $(K-S_T) - P = (90 - 80) - 5 = 5$. 
\hfill \break
Note that in this example, the time value of money was disregarded for simplicity purposes. 

\section{Arbitrage}
% https://www.investopedia.com/terms/a/arbitrage.asp
% concept of arbitrage in continous time is too narrow so we have to use a stronger concetpt such as 'no free lunch with vanishing risk'
In finance and economics, arbitrage is the practice to take advantage of market inefficiencies to make a risk-free profit. One such inefficiency can be, for example, the difference in prices of the same asset on two different markets. In other words, an arbitrage-free market is a market where there does not exist such trade (or a set of trades) which would allow a trader with zero capital at time $t=0$ to make a positive profit at some time in future $t=T$ with positive probability. In practice, arbitrage opportunities exist, but are very hard to spot and almost immediately exploited and the opportunity is gone, often in the matter of seconds.\\Here are two examples to better understand this very important principle:
\subsubsection{Example 1}
Suppose that the stock XYZ is trading for \$50 on the NYSE and the same stock is trading at \$49.5 at the LSE (London Stock Exchange). The trader can then buy the stock at LSE for \$49.5 and immediately sell it at NYSE for \$50, thus realizing profit of \$0.5. 
\subsubsection{Example 2}
% TODO: do another example where P[V(T) >= 0] = 1.0 and cannot be <0
% TODO: change this to the case when S_o e^r is not between S_u and S_d
Let's see a more complex example. Suppose we have a stock XYZ with spot price $S_0 = 100$ and in one year period there are only two possibilities for the stock movement: it can go up to $S_1 = u * S_0$ where $u=1.15$, or it can go down to $S_1 = d * S_0$ where $d=0.9$. The risk-free rate in the market is constant during this one-year period and it is $r=1\%$. The probability that the stock will go up in that period is $p=0.4$. 

% TODO: insert binomial tree picture here

The inconsistency is not easy to spot here. If the market is arbitrage-free, the expected value of the future payoff should be zero. By looking more closely, and considering the time value of money one can find the following arbitrage strategy:
We decide to short-sell the stock today and put that money in the bank to be remunerated at the risk-free rate of $1\%$. After one year we take out our money from the bank and now we own the value of $(1+r)S_0 = 101$. We have to buy back the stock that we shorted one year earlier to cover this short position. There are two possible scenarios:
\hfill \break
\begin{itemize}
	\item The stock went up and our profit in that case is: $(1+r)S_0 - uS_0$ = -14
	\item The stock went down and our profit in that case is: $(1+r)S_0 - dS_0$ = 11
\end{itemize}
\hfill \break
Although at the first glance this does not look like a good deal, we have to take into account the prbabilities of these events happening. More specifically, let us look at the expecte payoff at time $t=1$:

$$\mathbb{E}[\text{payoff at } t=1] = 0.4 * (-14) + 0.6 * 11 = 1$$


\newpage
\section{Fundamental theorems of asset pricing}
% bla bla about these theorems
\subsection{First fundamental theorem of asset pricing}
\begin{theorem}
A discrete market, on a discrete probability space ($\Omega$, $\mathcal{F}$, $\mathcal{P}$), is \textbf{arbitrage-free} if, and only if, there exists at least one risk neutral probability measure that is equivalent to the original probability measure, $\mathcal{P}$.
\end{theorem}

\hfill \break
This first theorem is important in that it ensures a foundamental property of market models. It will allow for some nice manipulations with discounted price processes we will mention later in this thesis.

% UNCOMMENT THE BELOW TO CONTINUE WORKING ON THE PROOF
% \subsubsection{Proof}
% % intuitive proof: https://stanford.edu/~ashlearn/RLForFinanceBook/ArbitrageCompleteness.pdf
% For illustration we will just prove the easier implication, i.e.\\\textit{Existence of Risk-neutral measure} $\Rightarrow$ \textit{Arbitrage-free}

% Suppose we have a discrete probability space ($\Omega$, $\mathcal{F}$, $\mathcal{P}$), such that $\Omega = \{\omega_1, ..., \omega_n\}$ and $\mathcal{P}: \Omega \rightarrow [0,1]$.

% \hfill \break
% A probability measure $\pi: \Omega \rightarrow [0,1]$ is said to be risk-neutral if the following holds:
% $$S_j^{(0)} = e^{-r}\sum_{i=1}^{n} \pi(\omega_i)S_j^{(i)}$$ 

\subsection{Second fundamental theorem of asset pricing}
\begin{theorem}
An arbitrage-free is said to be \textbf{complete} (every contingent claim replicable) if and only if there exists a unique risk-neutral measure equivalent to the physical one.
\end{theorem}

\hfill \break
This theorem can be reformulated in an equivalent way, that is the market is complete if and only if there exists only one source of randomness in asset dynamic. Although this property is common in many models it is sometimes not always considered desirable or realistic. 
\chapter{Stochastic processes}
% probability and random variables
% definition of a stochastic process
% filtration
Stochastic processes have a well defined purpose in several fields, and one of those fields is finance. They seem to be the perfect choice when it comes to modelling assets' dynamics, because their \textit{randomness} is used to replicate the uncertainty of asset prices that occurs in the market.\\

A continuous time \textbf{stochastic process} $\{X_t: t\ge 0\}$ is a collection of random variables indexed over time, often times simply $X(t)$. The probability space of these random variables is ($\Omega$, $\mathcal{F}$, $\mathbb{P}$), where $\Omega$ is the set of all possible outcomes, $\mathcal{F}$ is $\sigma$-algebra of events and $\mathbb{P}$ being the probability measure.\\
It is crucial to introduce a concept of filtration. \textbf{Filtration} $\{\mathcal{F}_t\}_{t\ge 0}$ is an increasing collection of $\sigma$-algebras, such that for every $0 \le s \le t$ the following holds: $\mathcal{F}_s \subseteq \mathcal{F}_t \subseteq \mathcal{F}$. Filtration can be thought of as \textit{"flow of information"}. More specifically, $\mathcal{F}_t$ can be considered as the information generated by all observed events up to time $t$.

% cadlag and caglad process
% martingale
	% semimartingale
	% local martingale
		% stopping time

\section{Brownian motion}
% Deriving Brownian motion from a random walk
The goal of this chapter is to show how Brownian motion can be derived from a random walk process. This is important to get a good understanding of what Brownian motion in fact is, as we will use it very extensively throughout the this text.

\noindent To describe the process of a \textbf{random walk} we will use a sequence of independent identically distributed (\textit{iid}) random variables $X_i$ with the following distribution:

$$ X_i \sim \left( \begin{array}{cc} h & -h \\
					p & q \end{array} \right)$$
Where $X_i$ describes the move of the particle in the the $i$-th step.
Let us calculate the expected value and the variance of each step:
$$
	% TODO: replace Var() with Var[] in the whole document
	\begin{array}{rl}
									\mathbb{E}[X_i] &= h(p-q) \\
		Var(X_i) = \mathbb{E}[X_i^2] - \mathbb{E}[X_i]^2 &= h^2(p-q) - h^2(p-q)^2 \\
										&= h^2p + h^2q - h^2(p^2 - 2p1 + q^2)\\
										&= h^2p(1-p) + h^2q(1-q) + 2h^2pq\\
										&= 4h^2pq \\
	\end{array}
$$
Now that we have the building blocks of the random walk, let us define the state of the random walk after $n$ steps as a random variable $X(t) = \sum_{i=1}^n X_i$. Where $t$ is the length of the interval $[0,t]$. This interval is divided into $n$ equal intervals of length $\Delta t$, so we have:
$$ \Delta t = \frac{t}{n}$$
We calculate the expected value and the variance of this new random variable:
$$
	\begin{array}{rl}
		\mathbb{E}[X(t)] &= nh(p-q) \\
		Var(X(t)) &\indeq \sum_{i=1}^n Var(X_i) = 4nh^2pq \\
	\end{array}
$$
According to the Central Limit Theorem with $n \rightarrow \infty$ we know that $X(t)$ will have a normal distribution, namely:
$$ \frac{\sum_{i=1}^n X_i - nh(p-q)}{\sqrt{n}\sqrt{Var(X_i)}} = \frac{\sum_{i=1}^n X_i - nh(p-q)}{2h\sqrt{n}\sqrt{pq}} \sim \mathcal{N}(0,1) $$
$$ \Rightarrow \sum_{i=1}^n X_i - nh(p-q) \sim \mathcal{N}(0,4nh^2pq)$$
$$ \sum_{i=1}^n X_i \sim \mathcal{N}(nh(p-q), 4nh^2pq)$$
we substitute $n=\frac{t}{\Delta t}$
$$ X(t) \sim \mathcal{N}(\mu t, \sigma^2t)$$
$$\mu := \lim_{\Delta x \to 0, h \to 0} \frac{h(p-q)}{\Delta t}$$
$$\sigma^2 := \lim_{\Delta x \to 0, h \to 0} \frac{4h^2pq}{\Delta t}$$

Where $\mu$ is called the \textbf{drift} and $\sigma^2$ the \textbf{diffusion} of the process $X(t)$. We can have a look at the special case where $p=q=0.5$ and $h=\sqrt{t/n}=\sqrt{\Delta t}$ and it is easy to see that then $X(t)$ has the following distribution:
$$ X(t) \sim \mathcal{N}(0, t) $$

\noindent The above mentioned process is called \textbf{Wiener process} and is often denoted by $W = \{W_t:t\ge 0\}$ where $W_t \sim \mathcal{N}(0,t)$. The formal definition is the following:

% REF: Tomas Bjork book reference
\begin{definition}[Wiener process]
A Wiener process is the process with the following properties:
\begin{enumerate}
	\item $W_0 = 0$
	\item $W_t$ is continuous in $t$
	\item $W_t$ has independent increments, i.e. for every $r < s \leq t < u$ increments $(W_u - W_t)$ and $(W_s - W_r)$ are independent random variables
	\item $W$ has Gaussian increments, i.e. for every $u,t \geq 0$: $(W_{t+u} - W_t) \sim \mathcal{N}(0,u)$
\end{enumerate}
\end{definition}

\section{Stochastic Integrals}
% REF: Tomas Bjork book chapter 4
As already stated in the earlier chapters, one of the objectives of this book is to study asset pricing in financial markets using stochastic processes. We want to model the price as a continuous time stochastic process and for this case the most complete and elegant theory is obtained if we use \textbf{diffusion processes} and \textbf{stochastic differential equations} as main building blocks. Although we already mentioned diffusion a couple of times, we have not really intuitively explained what it is. Loosely speaking, a stochastic process is a diffusion if its local dynamics can be approximated with the following stochastic difference equation:

$$ X_{t+h} - X_t = \mu(t,X_t)\Delta t + \sigma(t, X_t)\Delta W_t $$

\noindent where $\Delta W_t$ is defined as:
$$ \Delta W_t = W_{t+h} - W_t $$

\noindent If we let $h$ tend to $0$ we can write the above equation like this:
$$ dX_t = \mu(t,X_t)dt + \sigma(t, X_t)dW_t $$
\noindent Which can be interpreted as a shorthand for the folowing integral equation:

$$ X_t = X_0 + \int_0^t \mu(s,X_s)ds + \int_0^t \sigma(s,X_s)dW_s $$

\noindent The $ds$ integral can be viewed as a regular Riemann integral, whereas for the $dW_t$ integral we have to introduce a new concept - \textit{It\^{o} integral}.
In order to be able to construct a stochastic integral of form:
$$ \int_0^t g_sdW_s$$
\noindent we have to impose some kind of integrability condition on another stochastic process $g_s$.

% TODO: fix the formatting to be i, ii
\begin{definition}~\\
\begin{enumerate}
	\item We say that the process $g_s$ belongs to the class $\mathcal{L}^2[a,b]$ if the following holds:
	\begin{itemize}
		\item $ \int_a^b\mathbb{E}[g_s^2]ds < \infty $
		\item The process $g_s$ is adapted to filtration $\mathcal{F}_t^W$
	\end{itemize}
	\item We say the process $g$ belongs to the class $\mathcal{L}^2$ if $g$ belongs to $\mathcal{L}^2[0,t]$ for every $t$
\end{enumerate}
\end{definition}

\noindent We will show how the define the stochastic integral for the case of $g_s$ which is \textbf{simple}, i.e. such $g_s$ that there exist deterministic points in time $a=t_0 < t_1 < ... < t_n = b$, such that $g$ is constant on each subinterval. To put this formally, $g_s=g_{t_k}$ where $s \in [t_k,t_{k+1})$. In that case, the stochastic integral can be defined as follows:
$$ \int_a^bg_sdW_s = \lim_{n\rightarrow\infty} \sum_{k=1}^n g_{t_k-1}(W_{t_k} - W_{t_{k-1}}) \hspace{0.5cm} \text{, where } t_k = k\frac{t}{n}$$

\noindent The process $g_s$ is evaluated in the summation on the left-hand point ($t_{k-1}$) which is known as a \textbf{non-anticipatory} integration. This is a natural choice in finance ensurint that we use no information from the fututre for our present actions.

% TODO: see whether to incorporate this, maybe even change with the above.
\noindent For the case of $g_s$ which is not \textit{simple} (as described above), we have to use ...

\section{Martingales}
% REF: Tomas Bjork book
Theory of stochastic integration is closely related to the theory of martingales. Moreover, it is a foundation of the modern theory of financial derivatives. It would be unreasonable to not mention this topic, because of its extreme importance in the field. In discrete time, we say a stochastic process is a \textbf{martingale} if for any time $n$ the following properties hold:

\begin{center}
	\begin{itemize}
		\item $\mathbb{E}[|X_n|] < \infty$
		\item $\mathbb{E}[X_n | X_0, ..., X_{n-1}] = X_{n-1}$
	\end{itemize}
\end{center}

Where the first condition is more of a \textit{technical} condition and the second one is the most important one. The second condition states that if at any time $t=n$ we look at the expected value of the process at any time $t>n$, it is equal to the value of the process at time $t=n$. A process that is a martingale can be viewed as a model of a fair game.

\noindent In order to extend the definition of a martingale to a continuous case, let us first consider a concept of filtration ${\mathcal{F}}_{t \ge 0}$, that we have already mentioned earlier. As before, a filtration can be thought of as a \textit{flow of information} and $\mathcal{F}_t$ as the information generated by all observed events up to time $t$. For any random variable $X$ let the symbol
$$\mathbb{E}[X|\mathcal{F}_t]$$
represent the \textit{"expected value of $X$ given the information available up to time $t$"}. It is important to note here that for a fixed $t$, the object $\mathbb{E}[X|\mathcal{F}_t]$ is a random variable. Let, for example, a filtration be generated by the process $Y$, then the information available up to time $t$ will, of course, be dependent on the behaviour of the process $Y$ in the time interval $[0,t]$. Before defining a continous time martingale, let us first consider the following proposition:

\begin{itemize}
	\item \textit{If $Y$ and $Z$ are random variables, and $Z$ is $\mathcal{F}_t$-measurable (known at time $t$), then} $$\mathbb{E}[Z\cdot Y|\mathcal{F}_t] = Z \cdot \mathbb{E}[Y|\mathcal{F}_t]$$
	\item \textit{If $Y$ is a random variable and $s<t$, then} $$\mathbb{E}[\mathbb{E}[Y|\mathcal{F}_t]|\mathcal{F}_s] = \mathbb{E}[Y|\mathcal{F}_s]$$
\end{itemize}

\begin{definition}
A stochastic process $X$ is an $(\mathcal{F}_t)$-martingale if the following conditions hold:
\begin{itemize}
	\item $X$ is adapted to filtration $\{\mathcal{F}_t\}_{t\geq 0}$
	\item For all $t$ we have $$\mathbb{E}[|X_t|] < \infty$$
	\item For all $s$ and $t$, where $s\leq t$ we have $$\mathbb{E}[X_t|\mathcal{F}_s] = X_s$$
\end{itemize}
\end{definition}

The first condition above is a condition saying that the process $X_t$ is observable (known) at time $t$. The second one, like in discrete case, is just a technical condition. Also like in discrete case, the third condition is the important one, which states that the expected future value of the $X$, given the information available today, is equal to today's observed value of $X$. In other words, a martingale has an absence of drift.

\section{Stochastic Calculus and It\^{o}'s Lemma}
% LAST ANSWER HERE: https://math.stackexchange.com/questions/2686925/some-questions-on-the-details-of-an-integration-of-brownian-motion-against-itsel
When talking about stochastic processes, one can see that they are different than the usual functions. If we look at a infinitesimally small time interval $\Delta t$ and observe the function behaviourin that time interval, the function is a straight line. This is unfortunately not the case with the stochastic processes, where even if we \textit{zoom-in} on the trajectory, the trajectory is not smooth. Therefore, a japanese mathematician Kiyoshi It\^{o} started and created the field of \textbf{stochastic calculus} which is able to operate on stochastic processes. 

% TODO: Images of a normal function magnified - smooth, and of BM - noisy

We come to the very important theorem in the field of stochastic calculus and that is \textbf{It\^{o}'s lemma}.

\begin{theorem}[It\^{o}'s Lemma]
Assume that the process $X$ has a stochastic differential given by $$dX_t = \mu_t X_t dt + \sigma_t X_t dW_t$$ where $\mu$ and $\sigma$ are adapted processes, and let $f$ be a $C^{1,2}$-function. Define the process $Z$ by $Z(t) = f(t,X_t)$. Then $Z$ has a stochastic differential given by 
$$df(t, X_t) = \left(\frac{\partial f}{\partial t} + \mu_t X_t \frac{\partial f}{\partial x}+\frac{1}{2}\sigma_t^2 X_t^2 \frac{\partial^2f}{\partial x^2}\right)dt + \sigma X_t \frac{\partial f}{\partial x}dW_t$$
\end{theorem}
\noindent A proof of this theorem is outside the scope of this thesis and it is rather cumbersome. The power and importance of this theorem is that we can define the differential of a function of a stochastic process. This will prove to be an indispensible tool when we will be pricing an option, as the price of the option depends on the price of an asset, which means it is a function of the asset price.

\subsection{Geometric Brownian motion} \label{section_gbm}
% https://medium.com/the-quant-journey/a-gentle-introduction-to-geometric-brownian-motion-in-finance-68c37ba6f828
Let us now show how to apply It\^{o}'s formula for the case of \textit{geometric Brownian motion}. Before we start, it is crucial to first describe what kind of process that is. 

\begin{definition}
A process $X$ is said to be a \textbf{geometric Brownian motion} if it satisfies the following stochastic differential equation:

$$dX_t = \mu_t X_t dt + \sigma_t X_t dW_t$$

\end{definition}

\noindent where $\mu_t$ and $\sigma_t$ are \textit{drift} and \textit{diffusion} (respectively) of the process $X$. $W_t$ is the basic Brownian motion, that is $W_t \sim \mathcal{N}(0,t)$. Let us now consider a function $f(t,X_t) = \ln(X_t)$ which, of course, yields another stochastic process. Another way of representing the It\^{o}'s formula, which is maybe a bit more general is important to have in mind and that is the following: $$df = \frac{\partial f}{\partial t}dt + \frac{\partial f}{\partial x}dX_t + \frac{1}{2}\frac{\partial^2 f}{\partial x^2}(dX_t)^2$$
If we expand the $(dX_t)^2$ we get: $$(dX_t)^2 = (\mu_t X_t dt + \sigma_t X_t dW_t)^2 = \mu_t^2 X_t^2 (dt)^2 + 2\mu_t\sigma_tX_t^2dtdW_t + \sigma_t^2X_t^2(dW_t)^2$$ where we use the formal multiplication table: 

$$ \left\{ \begin{array}{c} (dt)^2 = 0, \\ dt\cdot dW_t = 0, \\ (dW_t)^2 = dt \end{array} \right. $$ so we have: $$(dX_t)^2 = \sigma_t^2X_t^2dt$$
Before we apply the It\^{o}'s formula to this problem, let us first calculate the partial derivatives that appear in the formula. 
$$
	\frac{\partial \ln(X_t)}{\partial t} = 0 \hspace{0.25cm} ; \hspace{0.25cm} \frac{\partial \ln(X_t)}{\partial x} = \frac{1}{x} \hspace{0.25cm} ; \hspace{0.25cm} \frac{\partial^2 \ln(X_t)}{\partial x^2} = -\frac{1}{x^2}
$$

Now we are finally ready to apply the formula. We will step by step derive the formula for $X_t$:
$$ df = 0\cdot dt + \frac{1}{X_t}dX_t - \frac{1}{2} \frac{1}{X_t^2}(dX_t)^2 $$
$$ df = \frac{1}{X_t} (\mu_t X_t dt + \sigma_t X_t dW_t) - \frac{1}{2}\frac{1}{X_t^2}\sigma_t^2 X_t^2 dt$$
$$ df = (\mu_t - \frac{1}{2}\sigma_t^2)dt + \sigma_t dW_t  $$
and if we integrate it over the time interval $[0,t]$ we get
$$ \int_0^t df(s) = \int_0^t (\mu_s - \frac{1}{2}\sigma_s^2) ds + \int_0^t \sigma_s dW_s $$
For simplicity purposes, let us assume that $\mu$ and $\sigma$ are constants. Then they can come outside of the integral and the resulting formula is
$$ \ln(X_t) - \ln(X) = (\mu-\frac{1}{2}\sigma^2)t + \sigma (W_t - W_0) $$
Remembering that the $W_0 = 0$ we get the following result:
$$ \ln\frac{X_t}{X_0} = (\mu-\frac{1}{2}\sigma^2)t + \sigma W_t $$
\begin{equation} \label{eqn_gbm}
	X_t = X_0\exp\left\{ (\mu-\frac{1}{2}\sigma^2)t + \sigma W_t \right\}
\end{equation}

This model is in finance also known as \textbf{log-normal asset return model}, because we are using logarithmic prices. It is important to note that this model only has \textbf{positive values} of stock prices, which is in that sense in line with the real world, where stock prices can not become negative. 

% TODO-RESOLVED: insert image of geometric brownian motion simulation
\vspace{1cm}
\begin{center}
% \begin{figure} \label{figure_gbm_paths}
\begin{tikzpicture}
\begin{axis}[
    title={Geometric Brownian motion ($\mu$=0.05, $\sigma$ = 0.4)},
    xlabel={t},
    ylabel={Price},
    xmin=0, xmax=1,
    ymin=30, ymax=210,
    ymajorgrids=true,
    grid style=dashed,
]
\addplot[color=orange] table {data/gbm1.dat};
\addplot[color=magenta] table {data/gbm2.dat};
\addplot[color=teal] table {data/gbm3.dat};
\addplot[color=olive] table {data/gbm4.dat};
\end{axis}
\end{tikzpicture}
% \caption{Geometric Brownian motion paths for parameters $\mu$=0.05 and $\sigma$ = 0.4}
% \end{figure}
\end{center}

\chapter{Pricing an asset}
% NEXT UP! - When you come back from Paris

% repeat geometric brownian motion formulation
% Optional but would be nice - already in the yellow writing pad: applying Ito's formula on discounted geometric brownian motion - showcase

% TODO: Write something about why we will use Jump-diffusion process to price an asset...

% Jump process
	\section{Poisson process}
	Poisson process and exponential distribution are very closely linked so let us have a look at exponential distribution first. Poisson process has some convenient mathematical properties, which has led to it being used as a mathematical model for seemingly random processes in various disciplines, including, of course, economics. It is named after French mathematician Simeon Denis Poisson despite the fact that he has never studied this process. The reason why it is called a Poisson process is that if a collection of points in some space forms a Poisson process than the number of those points in a finite size region is a random variable with a Poisson distribution. This will be step by step explained in next sections.
		\subsection{Exponential distribution}
		As mentioned earlier, exponential distribution is very closely linked to the Poisson process as the time between events in Poisson process has exponential distribution. It is a continuous analogue of the geometric distribution.
			\begin{definition}[Exponential distribution]
			\label{exponential}
			We say that a random variable $X$ is exponentially distributed if its probability density function (PDF) is:
			$$
				f(x) = \left\{ \begin{array}{lc} \lambda e^{-\lambda x} &, x \geq 0 \\
												0 &, x < 0 \end{array}\right.
			$$

			\noindent where $\lambda > 0$ is the parameter of the distribution, often called the rate parameter. The notation to indicate that a random variable is exponentially distributed is $$X \sim \varepsilon(\lambda)$$
			\end{definition}

			% REF: memorylessness -> https://en.wikipedia.org/wiki/Memorylessness
			\noindent The expected value of a random variable $X$ which is exponentially distributed is $$\mathbb{E}[X] = \frac{1}{\lambda}$$ The most famous property of the exponential distribution is memorylessness. \textbf{Memorylessness} is a property of certain probability distributions which refers to the fact that the waiting time until the occurrence of a certain event does not depend on how mych time has already elapsed. Memorylessness of an exponential distribution is formally expressed as: $$P(X > t + s | X>s) = e^{-\lambda t} = P(X > t)$$ If $X$ is a random variable modelling a waiting time, this would mean that the probability that we wait more than $t+s$ if we already know that at least $s$ time has elapsed, is the same as the probability that we will wait more than $t$. 
		\subsection{Defining a Poisson process}
		A \textbf{Poisson process} registers the occurrences of the certain event in a finite time interval. It notes the number of occurrences as well as times when the event happened. 
		\begin{definition}[Poisson process]
			Poisson process $(N_t, t \geq 0)$ is given by the following conditions:
			\begin{enumerate}
				\item $N_0 = 0$
				\item $N$ has independent increments
				\item Random variable $N(s,t) = N_t - N_s$ where $0 \leq s \leq t$, has a Poisson distribution with parameter $\lambda (t-s)$, that is $$ P(N_t - N_s = n) = e^{-\lambda(t-s)}\frac{[\lambda(t-s)]^n}{n!} $$
			\end{enumerate}
		\end{definition}

		% TODO: automate this part to be generated by the python script
		\begin{center}
		% \begin{figure} \label{figure_poisson_process}
		\begin{tikzpicture}
		\begin{axis}[
		    title={Poisson process with $\lambda = 4$},
		    xlabel={t},
		    xmin=0, xmax=1,
		    ymin=0, ymax=5,
		    ytick={1,2,3,4,5},
		    ymajorgrids=true,
		    grid style=dashed,
		]
		\addplot[domain=0:0.08372,black] {0};
		\addplot[domain=0.08372:0.49,black] {1};
		\addplot[domain=0.49:0.87997,black] {2};
		\addplot[domain=0.87997:0.949862,black] {3};
		\addplot[domain=0.949862:1.0,black] {4};
		\draw[dotted] (axis cs:0.08372,0) -- (axis cs:0.08372,1);
		\draw[dotted] (axis cs:0.49,1) -- (axis cs:0.49,2);
		\draw[dotted] (axis cs:0.87997,2) -- (axis cs:0.87997,3);
		\draw[dotted] (axis cs:0.949862,3) -- (axis cs:0.949862,4);
		\draw[dotted] (axis cs:6,6) -- (axis cs:6,-5);
		\addplot[holdot] coordinates{(0.08372,0)(0.49,1)(0.87997,2)(0.949862,3)};
		\addplot[soldot] coordinates{(0,0)(0.08372,1)(0.49,2)(0.87997,3)(0.949862,4)};
		\end{axis}
		\end{tikzpicture}
		% \caption{Poisson process path with deterministic increment of $1$ and parameter $\lambda = 4$}
		% \end{figure}
		\end{center}

		% REF: Derivative security pricing book pg. 253
		\noindent There is an alternative definition of a Poisson process which we will use when we will be defining a jump-diffusion process. As we already mentioned before, Poisson process registers occurrences of a certain event on a \textit{finite time interval}. If we let that interval to become very small and denote it by $h$, we denote the probabilities of the number occurrences by: 
		$$
			\begin{array}{rcl}
				P(N(h) \geq 2) &\mbox{=}& o(h) \\
				P(N(h) = 1) &\mbox{=}& \lambda h \\
				P(N(h) = 0) &\mbox{=}& 1 - \lambda h + o(h)
			\end{array}
		$$
		Where $o(h)$ is infinitesimally small amount, that is, some function with with the property: $$\lim_{h \to 0} \frac{o(h)}{h} = 0$$ Then we can let $dN$ denote an increment in the Poisson process on an infinitesimally small time interval $dt$. $$ dN = \left\{  \begin{array}{lcl} 1 & \mbox{with probability} & \lambda dt \\
																	0 & \mbox{with probability} & (1 - \lambda dt) \end{array} \right. $$
	
	\section{Pure Jump process}
		\subsection{Definition}
		Now that the Poisson process has been explained, it will be easy to understand the Jump process. Like we stated earlier, the Poisson process registers occurrences of certain events. When talking about a jump process those events that occur will be the jumps. On each such event the value of our Jump process will be increased by a ceratin value (it will \textit{"jump"}). The initial value of the Jump process is $J(0) = 0$. The size of the $i$-th jump will be a random variable $U_i$ independant of the Poisson process, that is $N(t) \bot U_i$ , $\forall i$. All $U_i$ are independent and identically distributed random variables (\textit{iid}).

		% REF: DSP pg. 255
		\begin{definition}
			We define a Jump process as 
			\begin{equation}
				J(t) = \sum_{i=1}^{N(t)} U_i
			\end{equation}
			assuming $J(0) = 0$. The Jump process is right-continuous.
		\end{definition}

		We will use $\mathbb{Q}_j$ and $\mathbb{Q}_u$ to indicate the probability measure governing the jump arrival times and the probability measure governing the jump sizes, respectively. We assume independence of the mentioned probability measures. Let us now have a look at the expected value of the Jump process we have just defined:

		\begin{equation} \label{eqn_e_jump} % \ref{eqn_e_jump}
		\mathbb{E}[J(t)] = \mathbb{E}^{\mathbb{Q}_j}\mathbb{E}^{\mathbb{Q}_u} \sum_{i=1}^{N(t)} U_i
		\end{equation}

		\noindent When performing the calculation we have to have in mind that $\mathbb{E}^{\mathbb{Q}_u}[U_i] = k$.

		\begin{equation}
		\begin{split}
			\mathbb{E}[J(t)] &= \sum_{n=0}^{\infty}\mathbb{E}^{\mathbb{Q}_u} \left[ \sum_{i=1}^{n} U_i \right] P(N(t)=n) = \sum_{n=0}^{\infty}\sum_{i=1}^{n} \mathbb{E}^{\mathbb{Q}_u}\left[U_i\right] P(N(t)=n) \\
			&= \sum_{n=0}^{\infty} nk\frac{(\lambda t)^n}{n!}e^{-\lambda t} = \sum_{n=1}^{\infty} nk\frac{(\lambda t)^n}{n!}e^{-\lambda t} \\
			&= ke^{-\lambda t}\lambda t\sum_{n=1}^{\infty}\frac{(\lambda t)^{n-1}}{(n-1)!} = k\lambda te^{-\lambda t}\sum_{n=1}^{\infty}\frac{(\lambda t)^n}{n!} \\
			&= k\lambda t
		\end{split}
		\end{equation}

		% \vspace{1cm}
		\begin{center}
		% \begin{figure} \label{figure_pure_jump_process}
		\begin{tikzpicture}
		\begin{axis}[
		    title={Pure Jump Process with $\lambda$ = 6 and jump size $U \sim \mathcal{N}(\mu=0,\sigma^2=0.04)$},
		    xlabel={t},
		    % ylabel={Price},
		    xmin=0, xmax=1,
		    % ymin=30, ymax=210,
		    ymajorgrids=true,
		    grid style=dashed,
		]
		\addplot[color=magenta] table {data/jump_process_path1.dat};
		\addplot[color=teal] table {data/jump_process_path2.dat};
		\addplot[color=olive] table {data/jump_process_path3.dat};
		\end{axis}
		\end{tikzpicture}
		% \end{figure}
		\end{center}

		\noindent As we can see the the expected value of the Jump process at time $t$ is different than $0$ which will subsequently lead to the conclusion that the process $J(t)$ is not a martingale. Sometimes it is useful to work with a Jump process which, in turn, is a martingale. Such process is called a \textbf{compensated Jump process}. 
		
		\begin{proposition} Let us denote a compensated Jump process with $\tilde{J}(t)$ and let it be defined by:
			\begin{equation}
			\tilde{J}(t) := J(t) - k\lambda t
			\end{equation}
			Such a process is a martingale.
		\end{proposition}
		\begin{proof}
			Let us assume we that we have $0 \leq s \leq t$ and we determine the expected value of the $\tilde{J}(t)$ given that we have information up to time $s$:
			\begin{align*}
				\mathbb{E}[\tilde{J}(t)|\mathcal{F}_s] &= \mathbb{E}[\tilde{J}(t) + \tilde{J}(s) - \tilde{J}(s)|\mathcal{F}_s] \\
				&= \mathbb{E}[\tilde{J}(t) - \tilde{J}(s)|\mathcal{F}_s] + \mathbb{E}[\tilde{J}(s)|\mathcal{F}_s] \\
				&= \mathbb{E}[\tilde{J}(t - s)] + \tilde{J}(s) \hspace{3cm} \mbox{\textit{(independent increments)}} \\
				&= \mathbb{E}[J(t - s) - k\lambda (t-s)] + \tilde{J}(s)\\
				&= k\lambda (t-s) - k\lambda (t-s) + \tilde{J}(s) \\
				&= \tilde{J}(s)
			\end{align*}
		\end{proof}

	Before we continue further and comobine the knowledge we have on geometric Brownian motion and Jump processes to obtain a Jump-diffusion process, let us first denote with $d\tilde{J}$ the change in the compensated Jump process in an infinitesimally small time interval $dt$:
	$$ d\tilde{J} = \left\{  \begin{array}{lcl} U_i - k\lambda dt& \mbox{with probability} & \lambda dt \\
																	- k\lambda dt & \mbox{with probability} & (1 - \lambda dt) \end{array} \right. $$
	\section{Jump-diffusion process}
	This has led us to the final part where we will obtain the final process of our asset price. This process will be the combination of the Geometric Brownian motion and a (compensated) Jump process. The reason to use a Jump-diffusion process as a process which will govern the price of an asset is because it better mimics the real-world situation where unexpected jumps can happen. In the previously defined jump process the jump sizes were \textit{iid} random variables $U_i$. We wish to make the jumps proportional to the value of the geometric Brownian motion at that point in time. Formally the differential form of a jump-diffusion process will be:

	\begin{equation} \label{eqn_jd}
		dX_t = \mu_tX_tdt + \sigma_tX_tdW_t + X_tUdN_t
	\end{equation} or also,
	\begin{equation} \label{eqn_jd_frac}
		\frac{dX_t}{X_t} = \mu_tdt + \sigma_tdW_t + UdN_t
	\end{equation} 
	% TODO: add a picture of an index with jumps
	We will assume, for simplicity purposes, that the $\mu, \sigma$ and $\lambda$ are constant in time. Further more, if we observe the behaviour of the process we can differentiate two different types of segments in the process:
	\begin{enumerate}
		\item between jumps it is driven by a pure diffusion process
		\item at jump times $(\tau_i)$ the value of the process after a jump depends on the value right before the jump $(\tau_i^-)$
	\end{enumerate}

	% REF: DSP pg. 260
	\noindent For the first case when the process is driven by a pure diffusion process we have
	\begin{equation}
		\frac{dX_t}{X_t} = \mu dt + \sigma dW_t
	\end{equation} which can be written also as 
	\begin{equation}
		d(\ln X_t) = (\mu - \frac{1}{2}\sigma^2)dt + \sigma dW_t
	\end{equation}

	% TODO: add charts
	\noindent After a jump at time $\tau_i$ we have that
	\begin{equation}
		X(\tau_i) - X(\tau_i^-) = U_i X(\tau_i^-)
	\end{equation}
	\noindent or equivalently
	\begin{equation}
		X(\tau_i) = X(\tau_i^-)(1 + U_i)
	\end{equation}
	\noindent In the part \ref{section_gbm} we have shown that the formula for the value of the diffusion process at time $t$ is $$X(t) = X(0)\exp\left[ (\mu-\frac{1}{2}\sigma^2)t + \sigma W_t \right]$$ which enables us to denote the value of the process right after the $i$-th jump as 

	$$X(\tau_i) = X(\tau_{i-1})\exp\left[ (\mu - \frac{1}{2}\sigma^2)\Delta\tau + \sigma W_{\Delta\tau} \right]\bigg(1+U_i\bigg)$$ 
	where $\Delta\tau = \tau_i - \tau_{i-1}$. If we would iterate this process, starting at $t=0$ and assuming there were no jumps at that time, we would get the final equation of the resulting asset price process:

	\begin{equation}\label{eqn_jump_diff}
		X(t) = X(0)\exp\left[ (\mu - \frac{1}{2}\sigma^2)t + \sigma W_{t} \right]\left(\prod_{i=1}^{N(t)}1+U_i\right)
	\end{equation}

	\noindent We have, however, not taken into account that the expected change in the resulting process is not anymore $X_t\mu dt$, because we have incorporated jumps and we have not compensated for it. In order to fix that we would have to compensate for that like we did earlier with the compensated Jump process. Doing that and then following the same logic as above we would obtain the following resulting equation for the value of the compensated jump-diffusion process at time $t$:
	\begin{equation} \label{eqn_jump_diff_compensated}
		X(t) = X(0)\exp\left[ (\mu - k\lambda- \frac{1}{2}\sigma^2)t + \sigma W_{t} \right]\left(\prod_{i=1}^{N(t)}1+U_i\right)
	\end{equation}

	\section{Simulations}
	% TODO: compare log-returns of GBM, JD and real stock log-returns - to obtain a normal-like distribution and show the difference

	% \begin{figure} \label{figure_jump_diffusion}
	\begin{tikzpicture}
	\begin{axis}[
	    title={Jump-diffusion process ($\mu$ = 0.05, $\sigma$ = 0.4, $\lambda$ = 4) with jump size $U \sim \mathcal{N}(0,0.04)$},
	    xlabel={t},
	    ylabel={Price},
	    xmin=0, xmax=1,
	    ymin=90, ymax=210,
	    ymajorgrids=true,
	    grid style=dashed,
	    legend pos=north west,
	]
	\addplot[color=olive] table {data/jump_diffusion_process.dat};
	% \draw[dotted] (axis cs:0.019759280317646837,0) -- (axis cs:0.019759280317646837,218.87657564987035);
	\addplot[dotted] coordinates {(0.019759280317646837,0) (0.019759280317646837,218.87657564987035)};
	\draw[dotted] (axis cs:0.4804255332905141,0) -- (axis cs:0.4804255332905141,218.87657564987035);
	\draw[dotted] (axis cs:0.4878563562516914,0) -- (axis cs:0.4878563562516914,218.87657564987035);
	\draw[dotted] (axis cs:0.5769236248364072,0) -- (axis cs:0.5769236248364072,218.87657564987035);
	\draw[dotted] (axis cs:0.6785902080596808,0) -- (axis cs:0.6785902080596808,218.87657564987035);

	\addlegendentry{Asset price}
	\addlegendentry{Jump times}

	\end{axis}
	\end{tikzpicture}
	% \end{figure}

\chapter{Pricing an option}
% merton jump diffusion model
% https://www.youtube.com/watch?v=URNN2_YPGVI

\section{It\^{o}'s Lemma for the Jump-diffusion Process}
ALthought Ito's lemma could have already been introduced and used to obtain the formulas \ref{eqn_jump_diff} and \ref{eqn_jump_diff_compensated} we chose to use the iterative process to obtain them. Now, when talking about pricing an option, which is a financial derivative and therefore \textit{derives} its value from the underlying price process, it comes naturally. The term derives means that price of an option can be defined as a function of the underlying price process. Let us denote with $X_t$ the underlying price process, which will be a \textbf{jump-diffusion process}. We are interested in obtaining a stochastic process driving the $f$ where: $$ f = f(X_t) $$
At times between the jumps, the process $X_t$ follows the simple diffusion and the change in $f$ in intervals between jumps can be expressed using It\^{o}'s lemma: 
\begin{equation} \label{eqn_diff_part}
\begin{split}
	df &= \frac{\partial f}{\partial t}dt + \frac{\partial f}{\partial x}dX_t + \frac{1}{2}\frac{\partial^2f}{\partial x^2}(dX_t)^2 \\
	   &= \bigg(\frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2}\bigg)dt + X_t\sigma\frac{\partial f}{\partial x}dW_t
\end{split}
\end{equation}

\noindent Whereas at jump times $t = \tau_i$ the change in $f$ is given by 
\begin{equation}
\begin{split}
	f(X_{\tau_i}) - f(X_{\tau_i^-}) &= f(X_{\tau_i^-} + X_{\tau_i^-}U_i) - f(X_{\tau_i^-}) \\
	   &= f(X_{\tau_i^-}(1+U_i)) - f(X_{\tau_i^-})
\end{split}
\end{equation}
The above equation can be rewritten for any time $t$ which is in that case
\begin{equation} \label{eqn_jump_part}
	f(X_t) - f(X_{t^-}) = [f(X_{t^-}(1 + U)) - f(X_{t^-})]dN_t
\end{equation}
Let us now define the expected change of f at jump times. This will be useful further on. If we donote the expected change in $f$ at jump times as $k_f$ it is
\begin{equation}
	k_f = \mathbb{E}^{\mathbb{Q}_u}[f(X_t) - f(X_{t^-})] = \int[f(X_{t^-}(1 + u)) - f(X_{t^-})]g(u)du
\end{equation} where $g(u)$ is the probability density function of the jump size.
If we were to look at the change $df$ in an infinitesimally small interval $dt$ conceptually we could define it as something like this:
$$
	df = \left\{  \begin{array}{lcl} DP & \mbox{with probability} & (1 - \lambda dt) \\
			  DP + JP & \mbox{with probability} & \lambda dt \end{array} \right. 
$$ where $DP$ is the change due to diffusion part (equation \ref{eqn_diff_part}), and $JP$ is the change due to the jump property of the underlying price process (equation \ref{eqn_jump_part}). Let us now examine the expected value of the change in $f$ with respect to both jump size distribution as well as jump time distribution. 

\begin{align*}
\mathbb{E}[df] = \mathbb{E}^{\mathbb{Q}_j}\mathbb{E}^{\mathbb{Q}_u}\mathbb{E}^{\mathbb{P}}[df] =& \bigg(\frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2}\bigg)dt(1-\lambda dt) + \\
& \bigg[\bigg(\frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2}\bigg)dt + k_f \lambda dt \bigg]\lambda dt \\
=& \bigg(\frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2}\bigg)dt + k_f \lambda dt \\
=& \bigg(\frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2} + k_f \lambda dt\bigg)dt
\end{align*}
We can denote with $\mu_f$ drift of the process $f$

\begin{equation}
	\mu_f = \frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2} + k_f \lambda dt
\end{equation}
And the expectation of the change in $f$ is then simply
$$
	\mathbb{E}[df] = \mu_f dt
$$
This allows us to specify $df$ more precisely than our conceptual picture of it:
$$
	df = \left\{  \begin{array}{lcl} (\mu_f - \lambda k_f)dt + \sigma_f dW_t & \mbox{with probability} & (1 - \lambda dt) \\
			  (\mu_f - \lambda k_f)dt + \sigma_f dW_t + [f(X_t) - f(X_{t^-})] & \mbox{with probability} & \lambda dt \end{array} \right. 
$$ where $$ \sigma_f = \sigma X_t\frac{\partial f}{\partial x} $$
The final part now is to rewrite it in the form of It\^{o}'s lemma:

\begin{equation} \label{eqn_ito_lemma_jd}
	df = (\mu_f - \lambda k_f)dt + \sigma_f dW_t + [f(X_t) - f(X_{t^-})]dN_t
\end{equation}
As we can see the resulting process is again a Jump-diffusion process, but now the drift $\mu_f$ of the process is not constant as before. We can see that $\mu_f$ as well as $k_f$ are now dependent also on $X_t$, but this is not an issue as the definition of a diffusion process allows that as well. For simplicity purposes earlier we decided to keep the $\mu$ and $\sigma$ constant. Now we have a general form of It\^{o}'s lemma for a function of our Jump-diffusion driven price process and this will help us in the next chapter where we will show that jumps add a non-systematic risk in play which is not possible to hedge using just the famous \textbf{delta hedge}.

\section{Constructing a Hedging Portfolio to price an Option}
% DSP page 145
In this section we will 

\subsection{Delta hedge}
% REF: capinski marek: financial engineering
The value of a European call or put option clearly depends on the underlying price process. For simplicity purposes we move for a bit in the Black-Scholes world where an underlying asset price follows a simple geometric Brownian motion without jumps. Let us consider a situation where we are short one option, that is we \textit{wrote} an option and sold it to somebody. The delta hedging strategy would tell us how many units of an underlying asset we would have to buy if we want to offset the risk of our portfolio for a small time interval $dt$. In other words, if we buy a correct amount of an underlying asset to hedge our position in an option the change in value of our portfolio in a small time interval $dt$ should be zero. The downside of a delta hedge is that it requires frequent readjustments of portfolio weight, which could, in real world, lead to high transaction costs. Although this is not really our most important concern it was important to flag it. Before actually applying it to our Jump-diffusion process and observing the issue let us define the delta hedge more precisely.

We take a portfolio composed of stock, bond and a derivative security (option). The value of the portfolio is given by
$$ V(X_t) = sX_t + yB(t) + zf(X_t)$$
where $s$ is the number of units of stock in the portfolio, $y$ is the number of units of a riskless asset (bond) in the portfolio and $z$ is the number of units of the derivative security.
The change in the portfolio value in an infinitesimally small time interval can be expressed as
$$
	dV(X_t) = \frac{d}{dX_t}V(X_t) \cdot dX_t
$$ We consider the case we illustrated above where we were short one derivative security or $z=-1$. The price of the bond is not dependend on the price of out stock so the derivative of portfolio value with respect to stock price is then $$ \frac{d}{dX_t}V(X_t) = s - \frac{d}{dX_t}f(X_t) $$ the goal of the delta hedge is to obtain such a portfolio that the change in the portfolio value with respect to change in price of the underlying asset is zero. More precisely the equation $\frac{dV}{dX_t} = 0$ must hold, which gives us the solution for the amount of stock that we have to buy to offset the portfolio risk we took over when we shorted one option. 

\begin{equation}
	s = \frac{d}{dX_t}f(X_t)
\end{equation} In the next section we will see how using this technique, although in another form, does not eliminate all the risk from a portfolio when the underlying asset price is governed by a jump-diffusion process. 

\subsection{Delta hedge for the Jump-diffusion process}
As we have already announced we will consider a case when our underlying asset follows the jump-diffusion process. Before we dive in into an examination of such a hedge we will briefly give a description of the processes involved. Firstly, the price process will be satisfying the stochastic differential equation for a jump-diffusion process (\ref{eqn_jd_frac}), namely
\begin{equation}\label{eqn_delta_hedge_x}
	\frac{dX_t}{X_t} = (\mu - \lambda k)dt + \sigma dW_t + UdN_t
\end{equation}

For the option price we will slightly modify the notation of certain parts of the equation \ref{eqn_ito_lemma_jd} to use $\mu_1, k_1$ and $\sigma_1$ instead of $\mu_f, k_f$ and $\sigma_f$
$$ df = (\mu_1 - \lambda k_1)dt + \sigma_1 dW_t + [f(X_t) - f(X_{t^-})]dN_t $$ where, of course, they stay the same:

$$ k_1 = \mathbb{E}^{\mathbb{Q}_u}[f(X_t) - f(X_{t^-})] = \int[f(X_{t^-}(1 + u)) - f(X_{t^-})]g(u)du $$
$$ \mu_1 = \frac{\partial f}{\partial t} + X_t(\mu - \lambda k)\frac{\partial f}{\partial x} + \frac{1}{2}X_t^2\sigma^2\frac{\partial^2 f}{\partial x^2} + k_1 \lambda dt $$
$$ \sigma_1 = \sigma X_t\frac{\partial f}{\partial x} $$
The reason for that is to have a nice notation when we divide the equation by $f$ to obtain the relative change in $f$:

\begin{equation} \label{eqn_delta_hedge_f}
	\frac{df}{f} = (\mu_f - \lambda k_f)dt + \sigma_f dW_t + U_fdN_t
\end{equation} where now we have $\mu_f = \frac{\mu_1}{f}, k_f = \frac{k_1}{f}$ and $\frac{\sigma_1}{f}$. One new notation detail that we introduced here is the $U_f$ which is defined as

\begin{equation}
	U_f = \frac{f(X_t) - f(X_{t^-})}{f(X_t)}
\end{equation}

One last thing we still have to define is the portfolio and its value. The portoflio is a set of weights $[\pi_1, \pi_2, ...]$ which tells us the proportion of our money invested into financial instruments 1,2,.. etc. 

$$ \sum_{i=1}^{n} \pi_i = 1 \hspace{0.5cm} \pi_i \in \mathbb{R},\forall i $$

We can see that the weights can be negative, which would mean that we are in short position for that instrument, that is we sold some amount of that instrument and will at some point have to buy back the same amount to cover. In our case we will have just a stock, a derivative security (option) and a riskless asset which can be for example a bond. Such defined portfolio then looks like this 
$$ \pi = [\pi_x, \pi_f, \pi_r] $$
The relative change in the portfolio value $V$ can be expressed as the following
\begin{equation}\label{eqn_delta_hedge_v}
	\frac{dV}{V} = \pi_x\frac{dX_t}{X_t} + \pi_f\frac{df}{f} + \pi_r dr
\end{equation}

Now we will incorporate the equations \ref{eqn_delta_hedge_x} and \ref{eqn_delta_hedge_f} into the above equation and regroup it a bit

\begin{align*}
	\frac{dV}{V} =& \pi_x [(\mu - \lambda k)dt + \sigma dW_t + UdN_t] \\&+\pi_f [(\mu_f - \lambda k_f)dt + \sigma_f dW_t + U_fdN_t] +\pi_r r dt \\
				 =& (\pi_x(\mu-\lambda k) + \pi_f (\mu_f - \lambda k_f) + \pi_r r) dt \\&+ (\pi_x\sigma + \pi_f\sigma_f)dW_t + (\pi_x U + \pi_f U_f)dN_t \\
				 =& (\mu_V - \lambda k_V) + \sigma_V dW_t + U_V dN_t
\end{align*} with this we obtained yet another jump diffusion process which now has new parameters $\mu_V, k_V, \sigma_V$ and $U_V$. Let us explicitly state the value of each one of them as we will see they will come in handy soon.

\begin{equation} \label{eqn_portfolio_params}
\begin{split}
	\mu_V =& \pi_x(\mu - r) + \pi_f(\mu_f - r) + r \\
	k_V =& \pi_x k + \pi_f k_f = \mathbb{E}^{\mathbb{Q}_U}[U_V] \\
	\sigma_V =& \pi_x\sigma + \pi_f\sigma_f \\
	U_V =& \pi_x U + \pi_f U_f
\end{split}
\end{equation}
If a process follows a simple diffusion process like in Black-Scholes world we would obtain a delta neutral portfolio by setting $\pi_x, \pi_f$ such that
\begin{equation} \label{eqn_portfolio_weights}
	\sigma_V = \pi_x\sigma + \pi_f\sigma_f = 0
\end{equation}
However, this choice of portfolio weights will not be able to eliminate the risk cause by the jump property of the resulting process. Actually, no choice of weights will be able to eliminate that risk. If we were to set the weights $\pi_x, \pi_f$ that will satisfy the equation \ref{eqn_portfolio_weights} and denote them with $\pi_x^*, \pi_f^*$ we would obtain a process defining the relative change in value $V^*$ of such portfolio
\begin{equation}
	\frac{dV^*}{V^*} = (\mu_V^* - \lambda k_V^*) + U_V^* dN_t
\end{equation}
Employing only the delta hedge we see that we did not offset all the risk and the problem of pricing our option is still left unsolved. The risk we still have is the jump risk and it represents \textit{non-systematic} risk. The ideas of \textit{systematic} and \textit{non-systematic} risk will be discussed in the following section together with a new idea that has to be employed in order to find the price of our option.

\subsection{Employing the Captial Asset Pricing Model}
% TODO: find this below, where is it from???
% From modern portfolio theory we have the result that portfolios containing only non-systematic risk have a beta factor of zero
\subsubsection{Capital Asset Pricing model (CAPM)} % REF: Hull; appendix CAPM
The \textbf{capital asset pricing model} is a model that describes the relationship between the expected return from an asset and the risk that comes with it. It assumes that the return should only be dependent on the systematic risk. \textit{Systematic} risk is the risk that is related to the market as a whole and it cannot be diversified away, whereas \textit{non-systematic} risk is unique to the asset and can be diversified away by choosing a large enough portfolio of different assets. The capital asset pricing formula is as follows:
\begin{equation} \label{eqn_capm}
	\mathbb{E}[R_i] = R_f + \beta_i (\mathbb{E}[R_m] - R_f)
\end{equation}
where $R_i$ denotes the return of the investment, $R_f$ is the return on the risk-free investment (i.e. risk-free rate), $R_m$ denotes the return of the market and $\beta$ is the factor that measures the systematic risk of the investment. When we say \textit{return of the market} we think of it as a return of some well-diversified stock index like NASDAQ or S\&P. The expression $(\mathbb{E}[R_m] - R_f)$ is called \textbf{market risk premium}, that is a premium received for taking over the risk by being exposed to the market. We can think of the $\beta$ factor of some potential investment as a measure of how sensitive the return of the investment is to the return of the market. 

\noindent To put this into perspective, if we encounter a factor $\beta = 0.5$ this means that, on average, the excess return of the investment is half the excess return of the market. When $\beta = 0$ that means that the investment is not sensitive to the movements in the market and therefore has no systematic risk. This may sound trivial, but this will be crucial in the next section when we will use this idea to obtain a fair price of the option.

\subsubsection{Obtaining the expression of the Option price}
From modern portfolio theory we know that portfolios containing only non-systematic risk have a $\beta$ factor equal to zero. From the CAPM formula for the expected return of investment it follows that a portfolio return must equal the riskless rate which we denote with $r$: $$ \mu_V = r $$ or if we incorporate that in \ref{eqn_portfolio_params} we get
\begin{equation} \label{eqn_comb_1}
	\pi_x(\mu - r) + \pi_f(\mu_f - r) = 0
\end{equation}
If we would also take the equation \ref{eqn_portfolio_weights} which ensures that we have a delta-neutral portfolio, we then obtain

\begin{equation} \label{eqn_sharpe}
	\frac{\mu - r}{\sigma} = \frac{\mu_f - r}{\sigma_f} = \phi
\end{equation}
The above ratio is called a \textbf{market price of risk} or  \textbf{Sharpe ratio}. We will denote it with $\phi$. There is a way to obtain a martingale representation of the price, although we will have to change to probability measure. We now incorporate the above equation into equations \ref{eqn_delta_hedge_x} and \ref{eqn_delta_hedge_f} and they can now be written as

$$ \frac{dX_t}{X_t} = (r - \lambda k)dt + \sigma (dW_t + \phi dt) + UdN_t $$
$$ \frac{df}{f} = (r - \lambda k_f)dt + \sigma_f (dW_t + \phi dt) + U_fdN_t $$
and if we denote with $d\tilde{W}_t$ a process
\begin{equation}
	d\tilde{W}_t = dW_t + \phi dt
\end{equation} or equivalently
\begin{equation}
	\tilde{W}(t) = W(t) + \int_0^s \phi(s) ds
\end{equation} which allows us to write down our final equations as

\begin{equation}\label{eqn_x_new_measure}
	\frac{dX_t}{X_t} = (r - \lambda k)dt + \sigma d\tilde{W}_t + UdN_t
\end{equation}
\begin{equation}
	\frac{df}{f} = (r - \lambda k_f)dt + \sigma_f d\tilde{W}_t + U_fdN_t
\end{equation}
Let us stop for a moment here and examine the equations. It can be shown that under the original probability measure $\mathbb{P}$ the process $\tilde{W}$ will not be a Wiener process:

\begin{equation*}
	\mathbb{E}^{\mathbb{P}}[\tilde{W}(t)] = \mathbb{E}^{\mathbb{P}}[W(t) + \int_0^s \phi(s) ds] = \int_0^s \phi(s) ds
\end{equation*}
% GIRSANOV THEOREM: look inside Stochastic Calculus for finance II
However, by applying the Girsanov theorem for processes involving jumps it allows us to assert that there exists and equivalent probability measure $\tilde{\mathbb{P}}$ under which the process $\tilde{W}$ is a Wiener process and $N$ remains a jump process with intensity $\lambda$. This is a very important step as it will us to easily obtain an expression which, not only tells us a lot, but also will allow as to price our option. There is only one ingredient missing in order to obtain an expression which will tell us how to calculate the price of our option. We are interested in the discounted price of the option, so we will introduce a function of the option price and call it $g$ $$ g(f) =  fe^{-rt} $$ As we will utilize It\^{o}'s lemma in order to obtain a differential of $g$, we first have to find the expressions for partial derivatives used in the lemma, namely
$$
	\frac{\partial g}{\partial t} = -fre^{-rt} \hspace{0.25cm} ; \hspace{0.25cm} \frac{\partial g}{\partial f} = e^{-rt} \hspace{0.25cm} ; \hspace{0.25cm} \frac{\partial^2 g}{\partial f^2} = 0
$$
and we apply the lemma to obtain the expression for the term $dg$
\begin{align*}
	d(fe^{-rt}) &= \frac{\partial g}{\partial t}dt + \frac{\partial g}{\partial f}df + \frac{1}{2}\frac{\partial^2 g}{\partial f^2}(df)^2 \\
				&= -re^{-rt}fdt + e^{-rt}df + 0 \\
				&= -re^{-rt}fdt + fe^{-rt}[r dt + \sigma_f d\tilde{W}_t + (U_fdN_t - \lambda k_f dt)] \\
				% &= -re^{-rt}fdt + re^{-rt}fdt + fe^{-rt}\sigma_f d\tilde{W}_t + fe^{-rt}(U_fdN_t-\lambda k_f dt) \\
				&= fe^{-rt}\sigma_f d\tilde{W}_t + fe^{-rt}(U_fdN_t-\lambda k_f dt)
\end{align*}
Which is a \textbf{martingale} under $\tilde{\mathbb{P}}$ because of the Girsanov theorem we mentioned earlier. This means that the following holds: 
\begin{equation*}
	\begin{split}
		f(t)e^{-rt} =& \mathbb{E}^{\tilde{\mathbb{P}}}[f(T)e^{-rT}|\mathcal{F}_t]\\
		f(t)e^{-rt} =& e^{-rT}\mathbb{E}^{\tilde{\mathbb{P}}}[f(T)|\mathcal{F}_t]
	\end{split}	
\end{equation*}
Which yields the final equation that we will use to price our option
\begin{equation}
f(t) = e^{-r(T-t)} \mathbb{E}^{\tilde{\mathbb{P}}}[f(T)|\mathcal{F}_t]
\end{equation}
When pricing our options we will focus on the options that have a signle fixed excercise date, which is the case for European options. If we think about it, the price of the European option at maturity $T$ has to be equal to the payoff of the option and the payoff is easy to calculate if we know the strike price and current price of the underlying security at $T$. The way we will utilize the expression obtained above is that we will simulate the paths of the process $X_t$ (\ref{eqn_x_new_measure}) and we will be able to emprically obtain the expected payoff of the option and with it, the price of the option.

% TODO: see what with this
% \section{Risk-Neutral Pricing Approach}
% % REF: not directly for this, but put in references 
% % https://www.math.fsu.edu/~dmandel/Primers/Understanding%20Market%20Price%20of%20Risk.pdf
% In this approach the idea is that the price of an option today should be the same as the discounted expected payoff of the option at a certain point in future. We denote the payoff of the option as a function of $X_t$, or

% \begin{equation}
% 	P(t) = P(X_t)
% \end{equation}

% final product should be f(X_t) = e^{-r(T-t)}E[f(X_T)]

\section{Simulations}
% choose one specific option (European call)
% do european put
% simulate option prices for different lambdas, strike prices, starting stock prices etc.
% plot the surface price(spot, strike)

% TODO: Monte Carlo simulations describe
% TODO: later choose some exotic option and price that one

\begin{tikzpicture}
\begin{axis}[
	% rf=2%, lambda=2, normal_jump function, 4000 simulations per point, 
    title={European Call Option price with strike price $K=100$ and maturity of $1$ year},
    xlabel={Spot price},
    ylabel={Call price},
    xmin=0, 
    % xmax=1,
    % ymin=0, 
    %ymax=210,
    ymajorgrids=true,
    legend pos=north west,
    grid style=dashed,
]
\addplot[color=magenta] table {data/option_price_lambda_0.dat};
\addplot[color=orange] table {data/option_price_lambda_1.dat};
\addplot[color=teal] table {data/option_price_lambda_2.dat}; 
\addplot[color=olive] table {data/option_price_lambda_4.dat}; 
\legend{$\lambda = 0$, $\lambda = 1$, $\lambda = 2$, $\lambda = 4$}
\end{axis}
\end{tikzpicture}


\chapter{Hedging}
% what is a local martingale?
% galtchouk kunita watanabe decomposition
% 

% Black Scholes world - delta hedge, distribution of the portfolio value dependent on the number of rebalance times - see DELTA_HEDGE_JUMP_PROCESSES_nick_thesis.pdf page 25
% TODO: for simulations show how the parameter of the frequency of readjusting the portfolio affects the portfolio value

\chapter{Conclusion}
Conclusion.

\bibliography{literatura}
% Use zotero for this
\bibliographystyle{fer}
\nocite{*}

\listoffigures

\newpage
\begin{abstract}
Stochastic processes have a widespread application in the computer science and in this thesis their application in the field of finance will be studied. The focus of this thesis will be to mathematically define a price of an asset using a jump-diffusion model which is then used to price a derivative. By programming simulations of prices of an asset and its derivative, their behaviour in time will be shown. After the prices of an asset and its derivative have been defined, we want to show how to mathematically define a problem of hedging a position. This also has to be accompanied with implemented simulations to illustrate the effect of hedging.

\keywords{stochastic processes, finance, pricing, options, hedging}
\end{abstract}

\hrvtitle{Određivanje cijene i premošćivanja rizika u slučaju difuzijskog procesa sa skokovima}
\begin{sazetak}
Stohastički procesi imaju široku primjenu u raznim područjima računarske znanosti, a u sklopu ovog rada istražit će se njihova primjena u području financija. Fokus rada je matematički definirati proces cijene nekog sredstva u obliku difuzijskog procesa sa skokovima, na temelju kojeg se naknadno određuje cijena njegovog financijskog derivata. Potrebno je programskim simulacijama cijena sredstva i derivata pokazati njihovo ponašanje u vremenu. Nakon što su spomenuti procesi cijena definirani, želimo pokazati kako se matematički može predstaviti i riješiti problem premošćivanja rizika, te navedeno popratiti programskim simulacijama scenarija s ciljem ilustracije efekta premošćivanja rizika.

\kljucnerijeci{stohastički procesi, financije, određivanje cijene, opcije, premošćivanje rizika}
\end{sazetak}

\end{document}
